# ISO 18013-5 Mobile Driving License (mDL)

## Overview

ISO 18013-5 defines the standard for mobile driving licenses (mDL) using ISO/IEC 18013-5:2021 specification.

---

## Key Features

- **CBOR Encoding**: Compact Binary Object Representation for efficient data storage
- **Selective Disclosure**: Share only requested data elements
- **Cryptographic Security**: Signed by issuing authority using PKI
- **Offline Capability**: Works without internet connectivity
- **Age Verification**: Zero-knowledge proofs for age-over checks

---

## Data Structure

### Namespaces

1. **org.iso.18013.5.1** (Standard mDL data)
   - family_name, given_name
   - birth_date, issue_date, expiry_date
   - document_number
   - portrait (facial image)
   - driving_privileges

2. **com.pocketone.claims** (Extensions)
   - master_code (MC)
   - trust_code (TC)

---

## Implementation in myID.africa

### Storage
- Encrypted in IndexedDB
- CBOR-encoded for efficiency
- Signed by HSM-backed CA

### Selective Disclosure
```typescript
const disclosed = MDLCredential.createSelectiveDisclosure(
  mdl,
  ['family_name', 'given_name', 'portrait']
);
```

### Age Verification
```typescript
const proof = MDLCredential.createAgeOverProof(mdl, 18);
// Returns: { isOver: true, proof: "hash..." }
```

---

## Security Features

1. **Issuer Authentication**
   - Certificate chain validation
   - Digital signature verification
   - Timestamp validation

2. **Device Binding**
   - Optional device authentication
   - Biometric verification
   - Secure enclave storage

3. **Anti-Cloning**
   - Unique credential ID
   - Counter mechanism
   - Active authentication

---

## Usage Flow

1. **Issuance**
   - User completes identity proofing
   - Authority generates mDL with digital signature
   - Credential stored encrypted locally

2. **Presentation**
   - Relying party requests specific data elements
   - User approves selective disclosure
   - mDL presented via QR code or NFC

3. **Verification**
   - Verifier checks issuer signature
   - Validates expiration date
   - Confirms data integrity

---

## Compliance

- ✅ ISO/IEC 18013-5:2021
- ✅ ICAO 9303 compatible
- ✅ eIDAS2 wallet integration
- ✅ W3C Verifiable Credentials compatible

---

## Code Example

```typescript
import { MDLCredential } from '@/lib/credentials/mdl-iso18013-5';

// Create mDL
const mdl = MDLCredential.create(
  {
    familyName: 'Hoffmeister',
    givenName: 'Anna',
    birthDate: '1990-05-15',
    documentNumber: 'DL123456789',
    issuingCountry: 'ZAF',
    issuingAuthority: 'South African Driving License Authority',
    issueDate: '2024-01-01',
    expiryDate: '2034-01-01',
  },
  masterCode,
  trustCode
);

// Encode to CBOR
const encoded = MDLCredential.encodeCBOR(mdl);

// Verify
const isValid = MDLCredential.verify(mdl);
```

---

## Resources

- [ISO 18013-5 Standard](https://www.iso.org/standard/69084.html)
- [myID.africa mDL Implementation](../lib/credentials/mdl-iso18013-5.ts)
- [CBOR Specification](https://cbor.io/)
